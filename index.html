<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Access Test</title>

  <!-- Firebase CDN -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>

<h1>アクセスボタン</h1>
<button id="accessBtn">アクセスする</button>

<script>
  // Firebase 設定（あなたのプロジェクトの値）
  const firebaseConfig = {
    apiKey: "AIzaSyDN0Bpaa_80Q34nc5Yfn9NzVa1OkdO6Iz0",
    authDomain: "project-5040932402734173095.firebaseapp.com",
    projectId: "project-5040932402734173095",
    storageBucket: "project-5040932402734173095.firebasestorage.app",
    messagingSenderId: "985201726384",
    appId: "1:985201726384:web:6295b669cc4a8a7626fc75"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const btn = document.getElementById("accessBtn");

  btn.addEventListener("click", async () => {
    const ref = db.collection("access").doc("counter");

    await db.runTransaction(async (transaction) => {
      const doc = await transaction.get(ref);

      const now = Date.now();
      let count = 1;
      let lastTime = 0;

      if (doc.exists) {
        const data = doc.data();
        lastTime = data.timestamp ? data.timestamp.toMillis() : 0;

        // 10秒以内ならカウントを増やす
        if (now - lastTime < 10000) {
          count = data.count + 1;
        }
      }

      // Firestore に更新
      transaction.set(ref, {
        count: count,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });

      // 遷移先
      if (count === 1) {
        window.location.href = "1.html";
      } else if (count === 2) {
        window.location.href = "2.html";
      } else {
        window.location.href = "2.html"; // 3人目以降は2.htmlに飛ばす
      }
    });
  });
</script>

</body>
</html>

